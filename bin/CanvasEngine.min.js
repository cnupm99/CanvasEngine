// version 1.10, build 77, Thu Aug 24 2017
(function(){var e=function(g,f){function e(){this.constructor=g}for(var k in f)m.call(f,k)&&(g[k]=f[k]);e.prototype=f.prototype;g.prototype=new e;g.__super__=f.prototype;return g},m={}.hasOwnProperty,p=function(g,e){return function(){return g.apply(e,arguments)}};define(function(){var g=function(d){function b(a){b.__super__.constructor.call(this,a);this.name=a.name||"";this.type="DisplayObject";this.canvas||(this.canvas=a.canvas);this.context||(this.context=a.context);this._setProperties(a)}e(b,d);
b.prototype.set=function(a){if(null!=a)return null!=a.visible&&(this.visible=a.visible),this.visible?this.show():this.hide(),null!=a.position&&this.move(a.position),null!=a.size&&this.resize(a.size),null!=a.realSize&&this.upsize(a.realSize),null!=a.center&&this.setCenter(a.center),null!=a.anchor&&this.setAnchor(a.anchor),null!=a.scale&&this.zoom(a.scale),null!=a.rotation&&this.rotate(a.rotation),null!=a.alpha&&this.setAlpha(a.alpha),null!=a.shadow&&this.setShadow(a.shadow),this.needAnimation=!0};
b.prototype.show=function(){return this.needAnimation=this.visible=!0};b.prototype.hide=function(){this.visible=!1;this.needAnimation=!0;return!1};b.prototype.move=function(a,b){this.position=this.pixel(a,b);this.needAnimation=!0;return this.position};b.prototype.shift=function(a,b){return this.move([a+this.position[0],b+this.position[1]])};b.prototype.resize=function(a,b){this.size=this.pixel(a,b);this.setAnchor(this.anchor);this.needAnimation=!0;return this.size};b.prototype.upsize=function(a,b){this.realSize=
this.pixel(a,b);this.setAnchor(this.anchor);return this.realSize};b.prototype.setCenter=function(a,b){this.center=this.pixel(a,b);var c=0===this.size[0]&&0===this.size[1]?this.realSize:this.size;this.anchor=[0===c[0]?0:this.center[0]/c[0],0===c[1]?0:this.center[1]/c[1]];this.needAnimation=!0;return this.center};b.prototype.setAnchor=function(a,b){this.anchor=this.point(a,b);var c=0===this.size[0]&&0===this.size[1]?this.realSize:this.size;this.center=[this["int"](c[0]*this.anchor[0]),this["int"](c[1]*
this.anchor[1])];this.needAnimation=!0;return this.anchor};b.prototype.zoom=function(a,b){this.scale=null!=a?this.point(a,b):[1,1];this.needAnimation=!0;return this.scale};b.prototype.rotate=function(a){this.rotation=this["int"](a);0>this.rotation&&(this.rotation=360+this.rotation);360<=this.rotation&&(this.rotation%=360);this._rotation=this.rotation*this._PIDIV180;this.needAnimation=!0;return this.rotation};b.prototype.rotateOn=function(a){return this.rotate(this.rotation+this["int"](a))};b.prototype.setAlpha=
function(a){this.alpha=a?this.number(a):1;0>this.alpha&&(this.alpha=0);1<this.alpha&&(this.alpha=1);this.needAnimation=!0;return this.alpha};b.prototype.setShadow=function(a){this.shadow=null!=a&&a?{color:a.color||"#000",blur:a.blur||3,offsetX:this["int"](a.offsetX),offsetY:this["int"](a.offsetY),offset:this["int"](a.offset)}:!1;this.needAnimation=!0;return this.shadow};b.prototype.testPoint=function(a,b){var c=this.canvas.getBoundingClientRect();c=this.context.getImageData(a-c.left,b-c.top,1,1).data;
null==c.every&&(c.every=Array.prototype.every);return!c.every(function(a){return 0===a})};b.prototype.testRect=function(a,b){var c=this.canvas.getBoundingClientRect();"scene"!==this.type&&(c={left:c.left+this.position[0],top:c.top+this.position[1],right:c.left+this.position[0]+this.size[0],bottom:c.top+this.position[1]+this.size[1]});return a>=c.left&&a<=c.right&&b>=c.top&&b<=c.bottom};b.prototype.animate=function(){this._deltaX=this.position[0];this._deltaY=this.position[1];this.shadow&&(this.context.shadowColor=
this.shadow.color,this.context.shadowBlur=this.shadow.blur,this.context.shadowOffsetX=Math.max(this.shadow.offsetX,this.shadow.offset),this.context.shadowOffsetY=Math.max(this.shadow.offsetY,this.shadow.offset));1===this.scale[0]&&1===this.scale[1]||this.context.scale(this.scale[0],this.scale[1]);1!==this.alpha&&(this.context.globalAlpha=this.alpha);0!==this.rotation&&(this.context.translate(this.center[0]+this.position[0],this.center[1]+this.position[1]),this.context.rotate(this._rotation),this._deltaX=
-this.center[0],this._deltaY=-this.center[1]);return this.needAnimation=!1};b.prototype._setProperties=function(a){(this.visible=null!=a.visible?a.visible:!0)?this.show():this.hide();this.move(a.position);this.realSize=[0,0];this.resize(a.size);null==a.center&&null!=a.anchor||this.setCenter(a.center);null!=a.anchor&&null==a.center&&this.setAnchor(a.anchor);this.zoom(a.scale);this.rotate(a.rotation);this.setAlpha(a.alpha);this.setShadow(a.shadow);return this.needAnimation=!0};return b}(function(){function d(b){}
d.prototype.point=function(b,a){return null==b?[0,0]:null!=a?[this.number(b),this.number(a)]:Array.isArray(b)?[this.number(b[0]),this.number(b[1])]:null!=b.x&&null!=b.y?[this.number(b.x),this.number(b.y)]:null!=b.width&&null!=b.height?[this.number(b.width),this.number(b.height)]:[0,0]};d.prototype.pixel=function(b,a){var c=this.point(b,a);return[c[0]>>0,c[1]>>0]};d.prototype["int"]=function(b){return this.number(b)>>0};d.prototype.number=function(b){return null!=b?+b:0};d.prototype.deg2rad=function(b){return this.number(b)*
this._PIDIV180};d.prototype._PIDIV180=Math.PI/180;return d}());var f=function(d){function b(a){b.__super__.constructor.call(this,a);this.childrens=[]}e(b,d);b.prototype.get=function(a){a=this.index(a);return-1===a?!1:this.childrens[a]};b.prototype.remove=function(a){a=this.index(a);if(-1===a)return!1;this.childrens.splice(a,1);return!0};b.prototype.rename=function(a,b){var c=this.index(a);if(-1===c)return!1;this.childrens[c].name=b;return!0};b.prototype.index=function(a){var b=-1;this.childrens.some(function(c,
l){var h;(h=c.name===a)&&(b=l);return h});return b};return b}(g);var m=function(d){function b(a){b.__super__.constructor.call(this,a);this._commands=[]}e(b,d);b.prototype.clear=function(){this._commands=[];return this.needAnimation=!0};b.prototype.beginPath=function(){return this._commands.push({command:"beginPath"})};b.prototype.lineCap=function(a){return this._commands.push({command:"lineCap",lineCap:a})};b.prototype.strokeStyle=function(a){return this._commands.push({command:"strokeStyle",style:a})};
b.prototype.fillStyle=function(a){return this._commands.push({command:"fillStyle",style:a})};b.prototype.linearGradient=function(a,b,h,l,d){return this._commands.push({command:"gradient",point1:this.pixel(a,b),point2:this.pixel(h,l),colors:d})};b.prototype.lineWidth=function(a){return this._commands.push({command:"lineWidth",width:this["int"](a)})};b.prototype.setLineDash=function(a){return this._commands.push({command:"setDash",dash:a})};b.prototype.lineDashOffset=function(a){return this._commands.push({command:"dashOffset",
offset:this["int"](a)})};b.prototype.moveTo=function(a,b){return this._commands.push({command:"moveTo",point:this.pixel(a,b)})};b.prototype.lineTo=function(a,b){this._commands.push({command:"lineTo",point:this.pixel(a,b)});return this.needAnimation=!0};b.prototype.line=function(a,b,h,d){this._commands.push({command:"line",from:this.pixel(a,b),to:this.pixel(h,d)});return this.needAnimation=!0};b.prototype.rect=function(a,b,h,d,e){null==e&&(e=0);this._commands.push({command:"rect",point:this.pixel(a,
b),size:this.pixel(h,d),radius:this["int"](e)});return this.needAnimation=!0};b.prototype.polyline=function(a,b){null==b&&(b=!0);this._commands.push({command:"beginPath"});this.moveTo(a[0][0],a[0][1]);a.forEach(function(a){return function(b){return a.lineTo(b[0],b[1])}}(this));b&&this.stroke();return this.needAnimation=!0};b.prototype.polygon=function(a){this.polyline(a,!1);this.lineTo(a[0][0],a[0][1]);this.stroke();return this.fill()};b.prototype.fill=function(){this._commands.push({command:"fill"});
return this.needAnimation=!0};b.prototype.stroke=function(){this._commands.push({command:"stroke"});return this.needAnimation=!0};b.prototype.animate=function(){b.__super__.animate.call(this);this.context.lineCap="round";return this._commands.forEach(function(a){return function(b){switch(b.command){case "beginPath":return a.context.beginPath();case "lineCap":return a.context.lineCap=b.lineCap;case "stroke":return a.context.stroke();case "fill":return a.context.fill();case "setDash":return a.context.setLineDash(b.dash);
case "dashOffset":return a.context.lineDashOffset=b.offset;case "moveTo":return a.context.moveTo(b.point[0]+a._deltaX,b.point[1]+a._deltaY);case "lineTo":return a.context.lineTo(b.point[0]+a._deltaX,b.point[1]+a._deltaY);case "line":return a.context.beginPath(),a.context.moveTo(b.from[0]+a._deltaX,b.from[1]+a._deltaY),a.context.lineTo(b.to[0]+a._deltaX,b.to[1]+a._deltaY),a.context.stroke();case "strokeStyle":return a.context.strokeStyle=b.style;case "fillStyle":return a.context.fillStyle=b.style;
case "lineWidth":return a.context.lineWidth=b.width;case "rect":return a.context.beginPath(),0===b.radius?a.context.rect(b.point[0]+a._deltaX,b.point[1]+a._deltaY,b.size[0],b.size[1]):a._drawRoundedRect(a.context,b.point[0]+a._deltaX,b.point[1]+a._deltaY,b.size[0],b.size[1],b.radius);case "gradient":var c=a.context.createLinearGradient(b.point1[0]+a._deltaX,b.point1[1]+a._deltaY,b.point2[0]+a._deltaX,b.point2[1]+a._deltaY);b.colors.forEach(function(a){return c.addColorStop(a[0],a[1])});return a.context.fillStyle=
c}}}(this))};b.prototype.log=function(){return console.log(this._commands)};b.prototype._drawRoundedRect=function(a,b,d,e,g,f){var c=Math.PI;var h=c/2;var l=b+f;var k=b+e-f;var m=d+f;var n=d+g-f;a.moveTo(l,d);a.lineTo(k,d);a.arc(k,m,f,-h,0);a.lineTo(b+e,n);a.arc(k,n,f,0,h);a.lineTo(l,d+g);a.arc(l,n,f,h,c);a.lineTo(b,m);return a.arc(l,m,f,c,3*h)};return b}(g);var k=function(d){function b(a){this._imageOnLoad=p(this._imageOnLoad,this);b.__super__.constructor.call(this,a);this.type="image";this.onload=
a.onload;this.loaded=!1;this.image=document.createElement("img");this.image.onload=this._imageOnLoad;this.loadedFrom="";null!=a.src?this.src(a.src):this.from(a.from)}e(b,d);b.prototype.src=function(a){this.loaded=!1;this.loadedFrom=a;return this.image.src=a};b.prototype.from=function(a,b){if(null!=a)return this.image=a,this.loadedFrom=b||"",this.upsize([this.image.width,this.image.height]),(0>=this.size[0]||0>=this.size[1])&&this.resize(this.realSize),this.needAnimation=this.loaded=!0};b.prototype.animate=
function(){if(this.loaded)return b.__super__.animate.call(this),this.size[0]===this.realSize[0]&&this.size[1]===this.realSize[1]?this.context.drawImage(this.image,this._deltaX,this._deltaY):this.context.drawImage(this.image,this._deltaX,this._deltaY,this.size[0],this.size[1])};b.prototype._imageOnLoad=function(a){this.upsize([this.image.width,this.image.height]);(0>=this.size[0]||0>=this.size[1])&&this.resize(this.realSize);this.needAnimation=this.loaded=!0;if(null!=this.onload)return this.onload(this.realSize)};
return b}(g);var q=function(d){function b(a){b.__super__.constructor.call(this,a);this.textWidth=this.fontHeight=0;this.setFont(a.font);this.setFillStyle(a.fillStyle);this.setStrokeStyle=a.strokeStyle||!1;this.setStrokeWidth(a.strokeWidth);this.write(a.text)}e(b,d);b.prototype.setFont=function(a){this.font=a||"12px Arial";a=document.createElement("span");a.appendChild(document.createTextNode("height"));a.style.cssText="font: "+this.font+"; white-space: nowrap; display: inline;";document.body.appendChild(a);
this.fontHeight=a.offsetHeight;document.body.removeChild(a);this.needAnimation=!0;return this.font};b.prototype.setFillStyle=function(a){this.fillStyle=a||!1;this.needAnimation=!0;return this.fillStyle};b.prototype.setStrokeStyle=function(a){this.strokeStyle=a||!1;this.needAnimation=!0;return this.strokeStyle};b.prototype.setStrokeWidth=function(a){this.strokeWidth=null!=a?this["int"](a):1;this.needAnimation=!0;return this.strokeWidth};b.prototype.write=function(a){this.text=a||"";this.context.save();
this.context.font=this.font;this.textWidth=this.context.measureText(this.text).width;this.context.restore();this.needAnimation=!0;return this.text};b.prototype.animate=function(){b.__super__.animate.call(this);this.context.font=this.font;this.context.textBaseline="top";if(this.fillStyle){if(Array.isArray(this.fillStyle)){var a=this.context.createLinearGradient(this._deltaX,this._deltaY,this._deltaX,this._deltaY+this.fontHeight);this.fillStyle.forEach(function(b){return a.addColorStop(b[0],b[1])});
this.context.fillStyle=a}else this.context.fillStyle=this.fillStyle;this.context.fillText(this.text,this._deltaX,this._deltaY)}if(this.strokeStyle)return this.context.strokeStyle=this.strokeStyle,this.context.lineWidth=this.strokeWidth,this.context.strokeText(this.text,this._deltaX,this._deltaY)};return b}(g);var r=function(d){function b(a){b.__super__.constructor.call(this,a);this.setRect(a.rect)}e(b,d);b.prototype.setRect=function(a){this.rect=a||[0,0,this.canvas.width,this.canvas.height];this.needAnimation=
!0;return this.rect};b.prototype.animate=function(){if(this.loaded)return this.context.beginPath(),this.context.fillStyle=this.context.createPattern(this.image,"repeat"),this.context.rect(this.rect[0],this.rect[1],this.rect[2],this.rect[3]),this.context.fill(),this.needAnimation=!1};return b}(k);var t=function(d){function b(a){var c=a.parent||document.body;this.canvas=document.createElement("canvas");this.canvas.style.position="absolute";c.appendChild(this.canvas);this.context=this.canvas.getContext("2d");
b.__super__.constructor.call(this,a);this.type="scene";this.setZIndex(a.zIndex);this.setMask(a.mask);this.needAnimation=!1}e(b,d);b.prototype.add=function(a){if(null!=a.type){null==a.visible&&(a.visible=this.visible);null==a.shadow&&(a.shadow=this.shadow);a.canvas=this.canvas;a.context=this.context;switch(a.type){case "image":var b=new k(a);break;case "text":b=new q(a);break;case "graph":b=new m(a);break;case "tile":b=new r(a)}this.childrens.push(b);return b}};b.prototype.setMask=function(a){this.mask=
null!=a&&a?a:!1;this.needAnimation=!0;return this.mask};b.prototype.setZIndex=function(a){this.zIndex=this["int"](a);return this.canvas.style.zIndex=this.zIndex};b.prototype.hide=function(){b.__super__.hide.call(this);return this.context.clearRect(0,0,this.size[0],this.size[1])};b.prototype.move=function(a,c){b.__super__.move.call(this,a,c);this.canvas.style.left=this.position[0]+"px";this.canvas.style.top=this.position[1]+"px";return this.position};b.prototype.resize=function(a,c){b.__super__.resize.call(this,
a,c);this.canvas.width=this.size[0];this.canvas.height=this.size[1];return this.size};b.prototype.setCenter=function(a,c){b.__super__.setCenter.call(this,a,c);this.context.translate(this.center[0],this.center[1]);return this.center};b.prototype.setAnchor=function(a,c){b.__super__.setAnchor.call(this,a,c);this.context.translate(this.center[0],this.center[1]);return this.anchor};b.prototype.rotate=function(a){b.__super__.rotate.call(this,a);this.context.rotate(this._rotation);return this.rotation};
b.prototype.setAlpha=function(a){b.__super__.setAlpha.call(this,a);return this.context.globalAlpha=this.alpha};b.prototype.animate=function(){if(this.visible)return this.context.clearRect(0,0,this.size[0],this.size[1]),this.mask&&(this.context.beginPath(),this.context.rect(this.mask[0],this.mask[1],this.mask[2],this.mask[3]),this.context.clip()),this.childrens.forEach(function(a){return function(b){a.context.save();b.animate();return a.context.restore()}}(this)),this.needAnimation=!1};return b}(f);
return function(d){function b(a){this._animate=p(this._animate,this);if(!this.canvasSupport())return console.log("your browser not support canvas and/or context"),!1;b.__super__.constructor.call(this,a);this.parent=a.parent||document.body;0===this.size[0]&&0===this.size[1]&&(this.size=[this["int"](this.parent.clientWidth),this["int"](this.parent.clientHeight)]);this._beforeAnimate=[];this._scene="default";this.add({type:"scene",name:"default"});this.start()}e(b,d);b.prototype.add=function(a){var b;
null==a&&(a={});if("scene"===(a.type||"scene"))return this._createScene(a);(b=this.get(a.scene))||(b=this.getActive());b||(b=this.add({type:"scene",name:"default"}));return b.add(a)};b.prototype.remove=function(a){a=this.index(a);if(-1===a)return!1;this.parent.removeChild(this.childrens[a].canvas);this.childrens.splice(a,1);return!0};b.prototype.onTop=function(a){var b=0;var d=!1;this.childrens.forEach(function(c){c.zIndex>b&&(b=c.zIndex);if(a===c.name)return d=c});d&&d.setZIndex(b+1);return d};b.prototype.getActive=
function(){var a;(a=this.get(this._scene))||(a=this.childrens[0]);a||(a=!1);return a};b.prototype.setActive=function(a){this._scene=a||"default";return this.getActive()};b.prototype.start=function(){return this._render=requestAnimationFrame(this._animate)};b.prototype.stop=function(){return cancelAnimationFrame(this._render)};b.prototype.addEvent=function(a){return this._beforeAnimate.push(a)};b.prototype.removeEvent=function(a){return this._beforeAnimate.forEach(function(b){return function(c,d){if(c===
a)return b._beforeAnimate.splice(d,1)}}(this))};b.prototype.fullscreen=function(a){null==a&&(a=!0);if(a)if(null!=this.parent.requestFullScreen)this.parent.requestFullScreen();else if(null!=this.parent.webkitRequestFullScreen)this.parent.webkitRequestFullScreen();else if(null!=this.parent.mozRequestFullScreen)this.parent.mozRequestFullScreen();else return!1;else if(null!=document.cancelFullScreen)document.cancelFullScreen();else if(null!=document.webkitCancelFullScreen)document.webkitCancelFullScreen();
else if(null!=document.mozCancelFullScreen)document.mozCancelFullScreen();else if(null!=document.exitFullScreen)document.exitFullScreen();else return!1;return!0};b.prototype.isFullscreen=function(){return null!=(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullscreenElement)};b.prototype.canvasSupport=function(){return null!=document.createElement("canvas").getContext};b.prototype._createScene=function(a){null==a.visible&&(a.visible=this.visible);null==a.position&&(a.position=
this.position);null==a.size&&(a.size=this.size);null==a.center&&(a.center=this.center);null==a.rotation&&(a.rotation=this.rotation);null==a.alpha&&(a.alpha=this.alpha);null==a.mask&&(a.mask=this.mask);null==a.shadow&&(a.shadow=this.shadow);a.parent=this.parent;a=new t(a);this.childrens.push(a);this.setActive(a.name);return a};b.prototype._animate=function(){this._beforeAnimate.forEach(function(a){return function(b,d){return"function"===typeof b?b():a._beforeAnimate.splice(d,1)}}(this));this.needAnimation=
!1;this.childrens.forEach(function(a){return function(b){var c=b.needAnimation||b.childrens.some(function(a){return a.needAnimation});a.needAnimation=a.needAnimation||c;if(c)return b.animate()}}(this));return this._render=requestAnimationFrame(this._animate)};return b}(f)})}).call(this);